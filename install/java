#!/bin/bash

[ -e ~/.install/java ] && exit

echo "######### Installing Oracle JDK #########"

# automate license
echo debconf shared/accepted-oracle-license-v1-1 select true | sudo debconf-set-selections
echo debconf shared/accepted-oracle-license-v1-1 seen true | sudo debconf-set-selections

sudo apt-get install dirmngr -y

# add Oracle JDK keys
sudo apt-get install software-properties-common -y
echo "deb http://ppa.launchpad.net/webupd8team/java/ubuntu precise main" | sudo tee -a /etc/apt/sources.list
echo "deb-src http://ppa.launchpad.net/webupd8team/java/ubuntu precise main" | sudo tee -a /etc/apt/sources.list
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys EEA14886

# fix 404 (source: https://stackoverflow.com/questions/46815897/jdk-8-is-not-installed-error-404-not-found )
cd /var/lib/dpkg/info
sudo sed -i 's|JAVA_VERSION=8u\d+|JAVA_VERSION=8u211|' oracle-java8-installer.*
sudo sed -i 's|PARTNER_URL=.*$|PARTNER_URL=https://download.oracle.com/otn/java/jdk/8u211-b12/478a62b7d4e34b78b671c754eaaf38ab/|' oracle-java8-installer.*
sudo sed -i 's|SHA256SUM_TGZ=.*$|SHA256SUM_TGZ="c0b7e45330c3f79750c89de6ee0d949ed4af946849592154874d22abc9c4668d"|' oracle-java8-installer.*
sudo sed -i 's|J_DIR=jdk1.8.0_\d+|J_DIR=jdk1.8.0_211|' oracle-java8-installer.*

# install oracle jdk
sudo apt-get update
sudo apt-get install oracle-java8-installer curl wget jq -y
sudo apt-get install oracle-java8-set-default -y

echo "Setting default java"
sudo sh -c 'echo JAVA_HOME="/usr/lib/jvm/java-8-oracle" >> /etc/environment'
source /etc/environment

mkdir -p ~/.install && touch ~/.install/java
